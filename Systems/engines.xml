<?xml version="1.0"?>



<system name="engine">
    
        <property>fcs/cutoff-switch</property>
        <property value="2.5">fcs/throttle-gain</property>
        
        <channel name="Engine">
           
            <kinematic name="Cutoff Switch Delay">
                <input>fcs/cutoff-switch</input>
                <traverse>
                    <setting>
                        <position>0.0000</position>
                        <time>0.0000</time>
                    </setting>
                    <setting>
                        <position>1.0000</position>
                        <time>1.0000</time>
                    </setting>
                </traverse>
            </kinematic>

            <pure_gain name="Throttle0 Cmd">
                <input>fcs/throttle-cmd-norm[0]</input>
                <gain>fcs/cutoff-switch-delay</gain>
            </pure_gain>
            <pure_gain name="Throttle1 Cmd">
                <input>fcs/throttle-cmd-norm[1]</input>
                <gain>fcs/cutoff-switch-delay</gain>
            </pure_gain>
            
            <!--la puissance maxi n'est disonible que sous condition-->
            <switch name="AugThrust">
                <default value="1"/>
                <test  logic="AND" value="0">
                    velocities/mach gt  1.15
                    position/h-sl-ft gt 28000
                </test>
                <output>fcs/intake-subsonic-pos</output>
            </switch>
            
            <pure_gain name="Throttle0 Cmd">
                <input>fcs/throttle-cmd-norm[0]</input>
                <gain>fcs/cutoff-switch-delay</gain>
            </pure_gain>
            
            <fcs_function name="Throttle0">
                <function>
                    <product>
                        <property>fcs/throttle0-cmd</property>
                        <difference>
                            <property>fcs/throttle-gain</property>
                            <property>fcs/intake-subsonic-pos</property>
                        </difference>
                    </product>
                </function>
            </fcs_function>
            
            <scheduled_gain name="propulsion/engine[0]/trim-throttle">
                <input>fcs/cutoff-switch-delay</input>
                <table>
                    <independentVar>velocities/vc-kts</independentVar>
                    <tableData>
                        0           0
                        450       0
                        470       1
                        1000     1
                    </tableData>
                </table>
            </scheduled_gain>
            
            <summer name="Throttle0 Pos Norm">
                <input>fcs/throttle0</input>
                <input>-propulsion/engine[0]/trim-throttle</input>
                <output>fcs/throttle-pos-norm[0]</output>
            </summer>
            
            <pure_gain name="Throttle1 Cmd">
                <input>fcs/throttle-cmd-norm[1]</input>
                <gain>fcs/cutoff-switch-delay</gain>
            </pure_gain>
            
            <fcs_function name="Throttle1">
                <function>
                    <product>
                        <property>fcs/throttle1-cmd</property>
                        <difference>
                        <property>fcs/throttle-gain</property>
                        <property>fcs/intake-subsonic-pos</property>
                        </difference>
                    </product>
                </function>
            </fcs_function>
            
            <scheduled_gain name="propulsion/engine[1]/trim-throttle">
                <input>fcs/cutoff-switch-delay</input>
                <table>
                    <independentVar>velocities/vc-kts</independentVar>
                    <tableData>
                        0           0
                        450       0
                        470       1
                        1000     1
                    </tableData>
                </table>
            </scheduled_gain>
            
            <summer name="Throttle1 Pos Norm">
                <input>fcs/throttle1</input>
                <input>-propulsion/engine[1]/trim-throttle</input>
                <output>fcs/throttle-pos-norm[1]</output>
            </summer>

            
            <!--pour une version avec moteurs séparés-->
            <!--<switch name="AugThrust0">
                <default value="1"/>
                <test  logic="AND" value="0">
                    fcs/throttle-pos-norm[0] gt 1
                </test>
                <output>propulsion/engine[0]/intake-subsonic-pos</output>
            </switch>-->

            <!--<switch name="AugThrust1">
                <default value="1"/>
                <test  logic="AND" value="0">
                    fcs/throttle-pos-norm[1] gt 1
                </test>
                <output>propulsion/engine[1]/intake-subsonic-pos</output>
            </switch>-->

            <switch name="Fuel Pump0 Cmd">
                <default value="0"/>
                <test  logic="AND" value="1">
                    fcs/cutoff-switch == 1
                </test>
            </switch>
            <pure_gain name="Fuel Pump0">
                <input>fcs/fuel-pump0-cmd</input>
                <gain>1</gain>
                <output>/controls/engines/engine[0]/fuel-pump</output>
            </pure_gain>

            <switch name="Fuel Pump1 Cmd">
                <default value="0"/>
                <test  logic="AND" value="1">
                    fcs/cutoff-switch == 1
                </test>
            </switch>
            <pure_gain name="Fuel Pump1">
                <input>fcs/fuel-pump1-cmd</input>
                <gain>1</gain>
                <output>/controls/engines/engine[1]/fuel-pump</output>
            </pure_gain>

            <switch name="Cutoff Cmd">
                <default value="1"/>
                <test  logic="AND" value="0">
                    fcs/cutoff-switch-delay == 1
                    fcs/fuel-pump0-cmd == 1
                    fcs/fuel-pump1-cmd == 1
                    /systems/electrical/outputs/fuel-pump gt 27
                </test>
                <output>propulsion/cutoff_cmd</output>
            </switch>
            
    </channel>



</system>
